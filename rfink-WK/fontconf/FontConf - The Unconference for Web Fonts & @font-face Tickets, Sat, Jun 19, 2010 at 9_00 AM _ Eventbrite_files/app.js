!function(a,b,c){"use strict";c.namespace("AdvancedTeams"),c.AdvancedTeams.TeamModel=c.Backbone.Model.extend({defaults:{name:"",public_event_id:null,password:null,errors:null},config:{eventsUrl:"/api/v3/events/",createTeamsUrl:"/teams/create/"},url:function(){return this.get("id")?"/teams/"+this.get("id")+"/update/team/":this.config.eventsUrl+this.get("public_event_id")+this.config.createTeamsUrl},checkPassword:function(b){return b=b||this.get("password"),a.post("/teams/"+this.get("id")+"/check_password/",{password:b},"json")}}),define("eb/advanced_teams/team_model",[],function(){return c.AdvancedTeams.TeamModel})}(window.jQuery,window._,window.EB),function(){"use strict";EB.namespace("AdvancedTeams"),EB.AdvancedTeams.TeamCollection=EB.Backbone.Collection.extend({model:EB.AdvancedTeams.TeamModel,initialize:function(a,b){if("object"!=typeof b||"undefined"==typeof b.eventID)throw"AdvancedTeams.TeamSearchView requires an event_id";this.eventID=b.eventID,this.url=this.url()},url:function(){return"/event/"+this.eventID+"/teams/search"},findByName:function(a){return a=a.toLowerCase(),this.find(function(b){return b.get("name").toLowerCase()===a})}}),define("eb/advanced_teams/team_collection",["eb/advanced_teams/team_model"],function(){return EB.AdvancedTeams.TeamCollection})}(),define("eb/advanced_teams/constants",{TeamSearchView:{FIELD_ERROR_SELECTOR:".js-team-password-error",SEARCH_INPUT_CLASS:".js-team-search-input",TEAM_SELECTED_EVENT:"select",AUTOCOMPLETE_DELAY:200}}),define("eb/components/teams/search/team_search_view",["require","jquery","backbone","eb-styleguide/js/ui_components/autocomplete/autocomplete_view","eb/advanced_teams/constants","eb/advanced_teams/team_model","eb/advanced_teams/team_collection","jquery_autocomplete"],function(a){"use strict";var b=a("jquery"),c=a("backbone"),d=a("eb-styleguide/js/ui_components/autocomplete/autocomplete_view"),e=a("eb/advanced_teams/constants"),f=a("eb/advanced_teams/team_model"),g=a("eb/advanced_teams/team_collection");return a("jquery_autocomplete"),c.View.extend({events:{"click .js-change-team":"handleChangeTeamClick","click .js-team-password-button":"handleTeamPasswordCheckClick","keyup .js-team-password-input":"handlePasswordKeyup","keydown .js-team-password-input":"handlePasswordKeydown","submit .js-team-search-form":"handleFormSubmit"},initialize:function(a){var c=this;if("object"!=typeof a||!(a.collection instanceof g))throw"AdvancedTeams.TeamSearchView requires an AdvancedTeams.TeamCollection";_.bindAll(this,"assignTeam","handlePasswordKeyup","findTeams","selectTeam","_checkPasswordResponse"),b(function(){c.render(),c.$teamPasswordInput=c.$(".js-team-password-input"),c.initializeAutocomplete()}),a.teamID&&this.collection.fetch({data:b.param({team_id:a.teamID})}).done(function(a){a.length>0?c.selectTeam(void 0,{item:a[0]}):c.$(".js-team-not-found").removeClass("is-hidden")})},initializeAutocomplete:function(){new d({el:this.$(e.TeamSearchView.SEARCH_INPUT_CLASS),minLength:2,select:this.selectTeam,source:this.findTeams,delay:e.TeamSearchView.AUTOCOMPLETE_DELAY})},findTeams:function(a,c){var d=a.term;this.$(".js-team-not-found").addClass("is-hidden"),this.$(".js-team-search-input").removeClass("has-form-input-error").parent().siblings(".form__field-error").addClass("is-hidden"),this.teamFetchDeferred=this.collection.fetch({data:b.param({term:d})}).done(this._parseTeams(d,c))},selectTeam:function(a,c){return this.currentlySelectedTeam=new f(c.item),this.$(e.TeamSearchView.SEARCH_INPUT_CLASS).autocomplete("close"),c.item.is_full?void this.$(".js-team-search-input").addClass("has-form-input-error").parent().siblings(".form__field-error").removeClass("is-hidden").html(gettext("Bummer! This team is full. Please join a different team.")):void(c.item.has_password?(this.authorizationDfd=b.Deferred(),this._showPasswordRequiredInput(c.item),this.authorizationDfd.done(this.assignTeam)):this.assignTeam())},assignTeam:function(){this.trigger(e.TeamSearchView.TEAM_SELECTED_EVENT,this.currentlySelectedTeam)},render:function(){return this.$el.html(this.options.template()),this},handleFormSubmit:function(a){var b=this,c=this.$(".js-team-search-input").val();a.preventDefault(),c.length<1||("undefined"==typeof this.teamFetchDeferred&&this.findTeams({term:c},function(){}),window.setTimeout(function(){b.teamFetchDeferred.done(function(a){a.length>0?b.selectTeam(void 0,{item:a[0]}):b.$(".js-team-not-found").removeClass("is-hidden")})},e.TeamSearchView.AUTOCOMPLETE_DELAY))},handleChangeTeamClick:function(a){a.preventDefault(),this.$(".js-team-search-input").val(""),this.$(".js-team-search-row").removeClass("is-hidden"),this.$(".js-team-info").addClass("is-hidden"),this.$(".js-team-password-row").addClass("is-hidden")},handleTeamPasswordCheckClick:function(a){a.preventDefault(),this._submitPassword()},handlePasswordKeydown:function(a){13===a.which&&a.preventDefault()},handlePasswordKeyup:function(a){a.preventDefault(),13===a.which&&this._submitPassword()},_showPasswordRequiredInput:function(a){var b=window.gettext('Looks like this team requires a password to join, or <a href="#" class="js-change-team">find another team.</a>');this.$(".js-team-search-row").addClass("is-hidden"),this.$(".js-team-info").html(this.options.teamInfoTemplate({teamName:a.name,teamLogo:a.logo,changeTeamPrompt:b})).removeClass("is-hidden"),this.$(".js-team-password-row").removeClass("is-hidden")},_submitPassword:function(){var a=this.$teamPasswordInput.val(),b=this.currentlySelectedTeam.checkPassword(a);b.done(this._checkPasswordResponse)},_checkPasswordResponse:function(a){a.token?(this.currentlySelectedTeam.set("token",a.token),this.authorizationDfd.resolve()):(this.$teamPasswordInput.addClass("has-form-input-error").siblings(e.TeamSearchView.FIELD_ERROR_SELECTOR).removeClass("is-hidden"),b(".js-team-password-error").addClass("form__field-error"),this.$teamPasswordInput.one("click keyup",function(){b(this).removeClass("has-form-input-error").siblings(e.TeamSearchView.FIELD_ERROR_SELECTOR).addClass("is-hidden"),b(".js-team-password-error").removeClass("form__field-error")}))},_parseTeams:function(a,b){return function(a){var c=_(a).map(function(a){var b=a.name;return a.is_full&&(b=interpolate(gettext("%(team_name)s (Full)"),{team_name:b},!0)),a.label=b,a.value=a.name,a});b(c)}}})}),this.Handlebars=this.Handlebars||{},this.Handlebars.templates=this.Handlebars.templates||{},this.Handlebars.templates.team_search=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i=c.helperMissing,j=this.escapeExpression;return h+='<form class="js-team-search-form form form--tall form--labels-medium l-align-center">\n    <div class="js-team-search-row form__row">\n        <span class="autocomplete-component l-align-left">\n            <input type="text" id="js-team-search-input" class="js-team-search-input form__input--long" placeholder="',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Search for a team",g):i.call(b,"_","Search for a team",g)))+'" />\n        </span>\n        <input type="submit" class="btn" value="',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Join",g):i.call(b,"_","Join",g)))+'">\n        <div class="is-hidden form__field-error"></div>\n    </div>\n\n    <div class="js-team-not-found is-hidden l-block-3 pod pod--alert form__row">\n        <div class="l-pad-vert-3 l-padded-h-2 has-centered-inline-content">\n            <p class="text-heading-secondary">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Whoops! We couldn't find the team name you entered.",g):i.call(b,"_","Whoops! We couldn't find the team name you entered.",g)))+"</p>\n            <p>",g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Check the spelling of your team name and try again.",g):i.call(b,"_","Check the spelling of your team name and try again.",g)))+'</p>\n        </div>\n    </div>\n\n    <div class="js-team-info is-hidden l-block-3 form__row"></div>\n\n    <div class="js-team-password-row is-hidden l-block-3 form__row form__row--label-column has-centered-inline-content">\n        <label class="form__label--column">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Enter Team Password",g):i.call(b,"_","Enter Team Password",g)))+'</label>\n        <input type="password" class="js-team-password-input form__input--medium" />\n        <button class="js-team-password-button btn">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Join",g):i.call(b,"_","Join",g)))+'</button>\n        <aside class="js-team-password-error is-hidden">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Sorry, that password is incorrect.",g):i.call(b,"_","Sorry, that password is incorrect.",g)))+"</aside>\n    </div>\n</form>\n"}),this.Handlebars.templates.team_info=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n                <div class="image-container image-container--square image--small">\n                    <img src="',(d=c.teamLogo)?d=d.call(a,{hash:{},data:b}):(d=a.teamLogo,d=typeof d===k?d.apply(a):d),e+=l(d)+'" />\n                </div>\n    '}function g(){return'\n                <i class="ico-box ico--color-subtle ico-team-created ico--medium"></i>\n    '}function h(a,b){var d,e,f="";return f+='\n            <div>\n                <span class="text-heading-primary">',(d=c.teamName)?d=d.call(a,{hash:{},data:b}):(d=a.teamName,d=typeof d===k?d.apply(a):d),f+=l(d)+'</span>\n                <div class="text-body-small">',e={hash:{},data:b},f+=l((d=c.markSafe||a.markSafe,d?d.call(a,a.changeTeamPrompt,e):m.call(a,"markSafe",a.changeTeamPrompt,e)))+"</div>\n            </div>\n    "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var i,j="",k="function",l=this.escapeExpression,m=c.helperMissing,n=this;return j+='<div class="pod pod--primary">\n    <div class="l-pad-vert-5 l-sm-pad-vert-3 l-pad-hor-4 l-sm-pad-hor-2 layout-padded--list-item l-media-v-center">\n        <div class="l-media-v-center__row">\n            <div>\n    ',i=c["if"].call(b,b.teamLogo,{hash:{},inverse:n.program(3,g,e),fn:n.program(1,f,e),data:e}),(i||0===i)&&(j+=i),j+="\n            </div>\n    ",i=c["if"].call(b,b.teamName,{hash:{},inverse:n.noop,fn:n.program(5,h,e),data:e}),(i||0===i)&&(j+=i),j+="\n        </div>\n    </div>\n</div>\n"}),define("templates/build/team_search",function(){}),this.Handlebars=this.Handlebars||{},this.Handlebars.templates=this.Handlebars.templates||{},this.Handlebars.templates.mobile_team_search=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g,h="",i=c.helperMissing,j=this.escapeExpression;return h+='<header class="pod__header js-team-info">\n    <h2 class="text-heading-primary has-centered-inline-content">\n        ',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Join a Team",g):i.call(b,"_","Join a Team",g)))+'\n    </h2>\n</header>\n\n<form class="form form--stacked form--tall js-team-search-form">\n\n    <div class="js-team-search-row form__row layout-padded--mobile">\n        <label class="form__row" for="team-search-input" >\n            <span class="text-body--medium text-body--understated">\n                ',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Find Your Team",g):i.call(b,"_","Find Your Team",g)))+'\n            </span>\n        </label>\n        <div class="form__row form__row--mobile l-media-flexible">\n            <div class="l-media-flexible__fluid">\n                <input type="text" class="js-team-search-input l-media-flexible__fluid__object" placeholder="',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Team Name",g):i.call(b,"_","Team Name",g)))+'" id="team-search-input" />\n                <div class="is-hidden form__field-error"></div>\n            </div>\n            <div class="l-media-flexible__fixed has-centered-inline-content">\n                <input type="submit" class="btn" value="',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Join",g):i.call(b,"_","Join",g)))+'">\n            </div>\n        </div>\n    </div>\n\n    <div class="js-team-not-found is-hidden l-block-3 l-pad-vert-5 l-sm-pad-vert-3 l-pad-hor-4 l-sm-pad-hor-2 pod pod--alert form__row">\n        <div class="l-pad-vert-3 l-padded-h-2 has-centered-inline-content">\n            <p class="text-heading-secondary">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Whoops! We couldn't find the team name you entered.",g):i.call(b,"_","Whoops! We couldn't find the team name you entered.",g)))+"</p>\n            <p>",g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Check the spelling of your team name and try again.",g):i.call(b,"_","Check the spelling of your team name and try again.",g)))+'</p>\n        </div>\n    </div>\n\n    <div class="layout-padded--mobile  js-team-password-row is-hidden">\n        <div class="form__row">\n            <label class="text-default text-body--faint" for="team-password">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Enter Team Password",g):i.call(b,"_","Enter Team Password",g)))+':</label>\n        </div>\n        <div class="l-block-3 form__row">\n            <input type="password" class="js-team-password-input form__input--full-width" id="team-password" />\n            <aside class="form__field-error is-hidden">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Sorry, that password is incorrect.",g):i.call(b,"_","Sorry, that password is incorrect.",g)))+'</aside>\n        </div>\n        <div class="l-block-3 form__row">\n            <a class="js-team-password-button btn btn--block">',g={hash:{},data:e},h+=j((f=c._||b._,f?f.call(b,"Join",g):i.call(b,"_","Join",g)))+"</a>\n        </div>\n    </div>\n\n</form>\n"}),this.Handlebars.templates.mobile_team_info=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e,f="";return f+="\n        ",e={hash:{},data:b},f+=k((d=c._||a._,d?d.call(a,"Join Team %s",a.teamName,e):j.call(a,"_","Join Team %s",a.teamName,e)))+"\n    "}function g(a,b){var d,e,f="";return f+="\n        ",e={hash:{},data:b},f+=k((d=c._||a._,d?d.call(a,"Join a Team",e):j.call(a,"_","Join a Team",e)))+"\n    "}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j=c.helperMissing,k=this.escapeExpression,l=this;return i+='<h2 class="text-heading-primary has-centered-inline-content">\n    ',h=c["if"].call(b,b.teamName,{hash:{},inverse:l.program(3,g,e),fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+="\n</h2>\n"}),define("templates/build/mobile_team_search",function(){}),define("eb/components/teams/search/app",["eb/advanced_teams/team_model","eb/advanced_teams/team_collection","eb/components/teams/search/team_search_view","templates/build/team_search","templates/build/mobile_team_search"],function(a,b,c){"use strict";var d;return d={create:function(d){var e=new b([],{eventID:d.eventID,model:a});return d.collection=d.collection||e,new c(d)},desktop:function(a){return a.template=Handlebars.templates.team_search,a.teamInfoTemplate=Handlebars.templates.team_info,d.create(a)},mobile:function(a){return a.template=Handlebars.templates.mobile_team_search,a.teamInfoTemplate=Handlebars.templates.mobile_team_info,d.create(a)}}});